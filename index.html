<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de Ticket avec IA</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #1c0000, #000);
            color: #fff;
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 10px;
            text-align: center;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }
        
        h1 {
            font-size: clamp(2em, 5vw, 3.5em);
            color: #ffd700;
            text-shadow: 3px 3px #ff0000;
            margin: 10px 0;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        #clock {
            font-size: clamp(1.2em, 3vw, 1.8em);
            color: #ff4444;
            background: #222;
            padding: 8px 15px;
            border: 2px solid #ffd700;
            border-radius: 5px;
            display: inline-block;
            margin: 5px auto;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }
        
        .ad-banner {
            background: linear-gradient(145deg, #cc0000, #990000);
            border: 2px solid #ff4444;
            color: #fff;
            padding: 8px;
            margin: 10px auto;
            width: 90%;
            max-width: 320px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.7);
            text-align: center;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .ad-banner:hover {
            transform: scale(1.02);
            box-shadow: 0 0 25px rgba(255, 68, 68, 1);
        }
        
        .ad-banner span.star-icon {
            color: #ffd700;
            font-size: 1.5em;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        .ad-dimensions {
            display: block;
            font-size: 0.9em;
            font-weight: normal;
            margin-top: 5px;
            color: #ffcccc;
        }
        
        .warning {
            color: #ff4444;
            font-size: clamp(1em, 2.5vw, 1.3em);
            font-weight: bold;
            margin: 10px auto;
            text-shadow: 1px 1px #000;
            padding: 0 10px;
        }
        
        #chat-box {
            width: 90%;
            max-width: 600px;
            flex: 1;
            min-height: 200px;
            max-height: calc(100vh - 400px);
            border: 3px solid #ffd700;
            padding: 15px;
            overflow-y: auto;
            margin: 10px auto;
            background: #111;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.6);
        }
        
        .user-message {
            text-align: right;
            margin: 8px 12px;
            padding: 10px;
            background: #cc0000;
            border-radius: 8px;
            color: #fff;
            max-width: 70%;
            margin-left: auto;
            font-size: 1.1em;
        }
        
        .bot-message {
            text-align: left;
            margin: 8px 12px;
            padding: 10px;
            background: #004400;
            border-radius: 8px;
            color: #fff;
            max-width: 70%;
            margin-right: auto;
            font-size: 1.1em;
            white-space: pre-wrap;
        }
        
        .typing-indicator {
            text-align: left;
            margin: 8px 12px;
            padding: 10px;
            background: #004400;
            border-radius: 8px;
            color: #fff;
            max-width: 70%;
            margin-right: auto;
            font-size: 1.1em;
        }
        
        .typing-indicator span {
            animation: blink 1.4s infinite;
            opacity: 0;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes blink {
            0%, 60%, 100% { opacity: 0; }
            30% { opacity: 1; }
        }
        
        #input-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px auto;
            width: 90%;
            max-width: 600px;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
        }
        
        #user-input {
            padding: 12px;
            font-size: 1.1em;
            border: 2px solid #ffd700;
            background: #222;
            color: #fff;
            border-radius: 5px;
            flex: 1;
            min-width: 150px;
        }
        
        #send-button {
            padding: 12px 20px;
            font-size: 1.1em;
            background: #ff0000;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        #send-button:hover {
            background: #ffd700;
            color: #000;
            transform: scale(1.05);
        }
        
        #send-button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: scale(1);
        }
        
        .footer {
            position: relative;
            width: 100%;
            color: #666;
            font-size: 0.8em;
            text-shadow: 1px 1px #000;
            padding: 10px 0;
            margin-top: auto;
        }
        
        /* Media queries pour mobile */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            h1 {
                margin: 5px 0;
            }
            
            #chat-box {
                max-height: calc(100vh - 350px);
                padding: 10px;
            }
            
            .user-message, .bot-message {
                font-size: 0.95em;
                padding: 8px;
                margin: 6px 8px;
            }
            
            #input-container {
                gap: 5px;
                padding: 5px;
            }
            
            #user-input {
                font-size: 1em;
                padding: 10px;
            }
            
            #send-button {
                padding: 10px 15px;
                font-size: 1em;
            }
        }
        
        @media (max-width: 480px) {
            #chat-box {
                max-height: calc(100vh - 320px);
            }
            
            .ad-banner {
                font-size: 0.9em;
                padding: 6px;
            }
            
            .warning {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <h1>G√âN√âRATEUR DE TICKETS + IA</h1>
    <div id="clock"></div>

    <div class="ad-banner">
        <span class="star-icon">‚≠ê</span> Banni√®re Publicitaire
        <span class="ad-dimensions">320x50 / 320x100 (Espace Publicitaire)</span>
    </div>
    <p class="warning">Tape "1h" pour un ticket ou pose-moi n'importe quelle question !</p>

    <div id="chat-box"></div>

    <div id="input-container">
        <input type="text" id="user-input" placeholder="Tape un message">
        <button id="send-button">Envoyer</button>
    </div>

    <div class="footer">
        G√©n√©rateur avec IA gratuite int√©gr√©e - Propuls√© par Hugging Face
    </div>

    <script>
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const clock = document.getElementById('clock');

        // Message de bienvenue
        addMessage('bot-message', "Salut ! Je suis ton assistant IA. Tape '1h' pour g√©n√©rer un ticket ou pose-moi n'importe quelle question !");

        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            clock.textContent = `${hours}:${minutes}:${seconds}`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        function addMessage(className, message) {
            const msg = document.createElement('div');
            msg.className = className;
            msg.textContent = message;
            chatBox.appendChild(msg);
            chatBox.scrollTop = chatBox.scrollHeight;
            return msg;
        }

        function showTypingIndicator() {
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.id = 'typing';
            indicator.innerHTML = '<span>‚óè</span><span>‚óè</span><span>‚óè</span>';
            chatBox.appendChild(indicator);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typing');
            if (indicator) {
                indicator.remove();
            }
        }

        function formatDate(date) {
            return `${String(date.getDate()).padStart(2, '0')}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getFullYear()).slice(-2)}`;
        }

        function formatTime(date) {
            return `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
        }

        function generateRandomSequence() {
            return Array.from({ length: 6 }, () =>
                String(Math.floor(Math.random() * 100)).padStart(2, '0')
            ).join("'");
        }

        function generateRandomLetter() {
            return String.fromCharCode(65 + Math.floor(Math.random() * 26));
        }

        function generateRandomCode() {
            const letter1 = generateRandomLetter();
            let letter2, letter3;
            do {
                letter2 = generateRandomLetter();
            } while (letter2 === letter1);
            do {
                letter3 = generateRandomLetter();
            } while (letter3 === letter1 || letter3 === letter2);
            const digit = Math.floor(Math.random() * 10);
            return `${letter1}${digit}${letter2}${letter3}`;
        }

        async function getAIResponse(message) {
            try {
                const response = await fetch('https://api-inference.huggingface.co/models/microsoft/DialoGPT-medium', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        inputs: message,
                        parameters: {
                            max_length: 200,
                            temperature: 0.9,
                            top_p: 0.95,
                        }
                    })
                });

                if (!response.ok) {
                    // En cas d'erreur API, utiliser une IA locale simple
                    return getLocalAIResponse(message);
                }

                const data = await response.json();
                return data[0]?.generated_text || getLocalAIResponse(message);
            } catch (error) {
                console.error('Erreur API:', error);
                return getLocalAIResponse(message);
            }
        }

        function getLocalAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // R√©ponses basiques intelligentes
            if (lowerMessage.includes('salut') || lowerMessage.includes('bonjour') || lowerMessage.includes('hello')) {
                return "Salut ! Comment puis-je t'aider aujourd'hui ? üòä";
            }
            if (lowerMessage.includes('comment') && lowerMessage.includes('vas')) {
                return "Je vais tr√®s bien merci ! Et toi ?";
            }
            if (lowerMessage.includes('merci')) {
                return "De rien ! N'h√©site pas si tu as besoin d'autre chose.";
            }
            if (lowerMessage.includes('ticket')) {
                return "Pour g√©n√©rer un ticket, tape simplement '1h' !";
            }
            if (lowerMessage.includes('aide') || lowerMessage.includes('help')) {
                return "Je peux r√©pondre √† tes questions et g√©n√©rer des tickets. Tape '1h' pour un ticket ou pose-moi une question !";
            }
            if (lowerMessage.includes('qui es-tu') || lowerMessage.includes('qui es tu')) {
                return "Je suis une IA conversationnelle gratuite int√©gr√©e √† ce g√©n√©rateur de tickets. Je suis l√† pour discuter et t'aider !";
            }
            if (lowerMessage.includes('pourquoi') || lowerMessage.includes('comment')) {
                return "C'est une excellente question ! Pourrais-tu √™tre plus pr√©cis pour que je puisse mieux t'aider ?";
            }
            if (lowerMessage.includes('blague') || lowerMessage.includes('rire')) {
                const blagues = [
                    "Pourquoi les plongeurs plongent-ils toujours en arri√®re ? Parce que sinon ils tombent dans le bateau ! üòÑ",
                    "Qu'est-ce qu'un crocodile qui surveille la pharmacie ? Un Lacoste garde ! üêä",
                    "Comment appelle-t-on un chat tomb√© dans un pot de peinture ? Un chat-pineau ! üé®"
                ];
                return blagues[Math.floor(Math.random() * blagues.length)];
            }
            
            // R√©ponse g√©n√©rique intelligente
            const responses = [
                "Int√©ressant ! Peux-tu m'en dire plus ?",
                "Je comprends ce que tu veux dire. Continue...",
                "C'est une bonne remarque ! Que penses-tu d'autre √† ce sujet ?",
                "Hmm, je vois. Tu as d'autres questions ?",
                "Je prends note ! Autre chose √† ajouter ?"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        async function handleMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            // D√©sactiver le bouton pendant le traitement
            sendButton.disabled = true;
            userInput.disabled = true;

            addMessage('user-message', message);
            userInput.value = '';

            // Cas sp√©cial pour le ticket
            if (message === '1h') {
                const now = new Date();
                const oneHourLater = new Date(now.getTime() + 60 * 60 * 1000);

                const ticket = `Titre 1 voyage\n\nValable 1 heure d√®s r√©ception du SMS\nLe ${formatDate(now)}\nDe ${formatTime(now)} √† ${formatTime(oneHourLater)}\n\n1.35 E\n\n${generateRandomSequence()}\n\n0783643942${generateRandomCode()}\n\nCGV : www.tcat.fr/cgv-ticket-sms`;

                setTimeout(() => {
                    addMessage('bot-message', ticket);
                    sendButton.disabled = false;
                    userInput.disabled = false;
                    userInput.focus();
                }, 1000);

                navigator.clipboard.writeText(ticket)
                    .then(() => console.log('Ticket copi√© dans le presse-papiers'))
                    .catch(err => console.error('Erreur de copie :', err));
            } else {
                // R√©ponse IA pour les autres messages
                showTypingIndicator();
                
                const aiResponse = await getAIResponse(message);
                
                hideTypingIndicator();
                addMessage('bot-message', aiResponse);
                sendButton.disabled = false;
                userInput.disabled = false;
                userInput.focus();
            }
        }

        sendButton.addEventListener('click', handleMessage);

        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !sendButton.disabled) {
                handleMessage();
            }
        });
    </script>
</body>
</html>
